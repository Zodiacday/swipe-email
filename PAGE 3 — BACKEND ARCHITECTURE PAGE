3. BACKEND ARCHITECTURE
This page defines the entire backend system, including provider integrations, normalization, action execution, safety guarantees, and system‑level behavior.
It is designed to be implementation‑ready.

3.1 System Overview
The backend is responsible for:

Connecting to email providers

Fetching and normalizing email metadata

Executing user actions (delete, unsubscribe, block, keep, nuke domain)

Ensuring safety and reversibility

Logging all events

Powering the AI layer

Powering the swipe UI

Powering automation rules

The backend is stateless except for:

Database

Logs

Rules

User settings

AI learning signals

The backend must be:

Fast

Safe

Predictable

Provider‑agnostic

Scalable

Transparent

3.2 Provider Integrations
The system supports:

Gmail API

Outlook Graph API

Yahoo API

iCloud IMAP

Fastmail IMAP

Generic IMAP fallback

Each provider is wrapped in a Provider Adapter with a unified interface.

3.3 Gmail API Integration
Authentication
OAuth 2.0

Scopes:

gmail.readonly

gmail.modify

gmail.labels

gmail.settings.basic

Fetching Emails
Use users.messages.list with filters:

category:promotions

category:social

is:unread

newer_than:30d

Fetching Metadata
Use users.messages.get with format=metadata.

Extract:

From

Subject

Date

Labels

List‑Unsubscribe header

Message‑ID

Thread‑ID

Deleting Emails
Use users.messages.trash.

Blocking Senders
Gmail does not support true blocking.
We simulate blocking by:

Creating a filter:

If From = sender

→ Move to Trash

→ Mark as read

Unsubscribe
Use List‑Unsubscribe header

If HTTP link exists → trigger

If mailto exists → send unsubscribe email

Rate Limits
Respect Gmail’s per‑user quota

Implement exponential backoff

Cache metadata to reduce calls

3.4 Outlook API Integration
Authentication
OAuth 2.0

Scopes:

Mail.ReadWrite

Mail.Send

MailboxSettings.Read

Fetching Emails
Use /me/messages with filters:

isRead eq false

receivedDateTime ge last30days

contains(subject,'unsubscribe')

Deleting Emails
PATCH → isDeleted = true

Blocking Senders
Outlook supports block rules:

Add sender to blockedSenders list

Create inbox rule → move to Junk

Unsubscribe
Outlook often includes unsubscribe actions in message extensions.

Rate Limits
Use retry‑after header

Queue requests

3.5 IMAP Fallback Integration
Used for:

iCloud

Fastmail

Generic IMAP providers

Authentication
Username + app‑specific password

TLS required

Fetching Emails
Use SEARCH with:

UNSEEN

SINCE

HEADER List-Unsubscribe

Metadata Extraction
Parse:

From

Subject

Date

Headers

Flags

Deleting Emails
STORE +FLAGS (\Deleted)

EXPUNGE

Blocking Senders
IMAP has no block functionality.
We simulate blocking by:

Creating local rules

Auto‑deleting matching senders

Unsubscribe
Parse List‑Unsubscribe header

Trigger HTTP or mailto

3.6 Email Normalization Layer
All providers output different formats.
We normalize into a unified Email Object:

Code
Email {
  id: string
  provider: "gmail" | "outlook" | "imap"
  provider_id: string
  sender: string
  sender_domain: string
  subject: string
  timestamp: number
  list_unsubscribe: {
    http: string | null
    mailto: string | null
  }
  category: "newsletter" | "promo" | "social" | "unknown"
  metadata: object
}
Normalization ensures:

Consistent fields

Consistent timestamps

Consistent domain extraction

Consistent unsubscribe parsing

3.7 Action Engine
The Action Engine executes all swipe actions.

Supported actions:

1. DELETE
Moves email to trash

Logs action

Supports undo

2. UNSUBSCRIBE
Uses List‑Unsubscribe header

HTTP → GET/POST

Mailto → send unsubscribe email

Fallback → mark as spam

3. BLOCK SENDER
Gmail → create filter

Outlook → add to blockedSenders

IMAP → local rule

4. KEEP
Marks email as “kept”

Removes from swipe queue

AI learns from KEEP

5. NUKE DOMAIN
Block all senders from domain

Delete all existing emails

Create rule for future emails

3.8 Safety Guarantees
Safety is non‑negotiable.

Undo Everywhere
Every action must be reversible for at least 30 seconds.

No Auto‑Actions
AI never deletes or blocks without user approval.

No Content Reading
AI uses metadata only.

No Permanent Deletion
Trash is used instead of permanent delete.

Provider‑Safe Behavior
Respect provider rules and rate limits.

3.9 Logging & Event System
Every action generates a log entry:

Code
ActionLog {
  id
  user_id
  email_id
  action_type
  timestamp
  provider
  metadata
}
Logs power:

Undo

Stats

AI learning

Automation

Analytics

3.10 Performance Requirements
Fetch 100 emails in < 2 seconds

Execute actions in < 200ms

Undo in < 100ms

AI suggestions in < 150ms

Provider calls batched when possible

3.11 Error Handling
Provider Errors
Retry with exponential backoff

Fallback to cached metadata

Unsubscribe Errors
Retry HTTP

Retry mailto

Fallback to block sender

IMAP Errors
Reconnect

Re‑authenticate

Retry command

User Errors
Invalid swipe → ignore

Invalid provider → fallback
